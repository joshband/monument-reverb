{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://visual-dna-studio.ai/schemas/component.manifest.schema.json",
  "title": "Photorealistic RGBA UI Component Manifest",
  "type": "object",
  "required": ["schemaVersion", "component", "layers", "stateLogic"],
  "additionalProperties": false,

  "properties": {
    "schemaVersion": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },

    "component": {
      "type": "object",
      "required": ["id", "type", "geometry", "behavior"],
      "additionalProperties": true,
      "properties": {
        "id": { "type": "string" },
        "displayName": { "type": "string" },

        "type": {
          "type": "string",
          "enum": ["knob.rotary", "toggle.deadpan", "slider.linear"]
        },

        "authoring": {
          "type": "object",
          "properties": {
            "unit": { "type": "string" },
            "canvas": {
              "type": "object",
              "properties": {
                "width": { "type": "integer", "minimum": 1 },
                "height": { "type": "integer", "minimum": 1 }
              }
            },
            "dpiHint": { "type": "integer" },
            "exportFormat": { "type": "string" },
            "premultipliedAlpha": { "type": "boolean" }
          }
        },

        "geometry": {
          "type": "object",
          "required": ["anchor", "hitRegion"],
          "properties": {
            "anchor": {
              "type": "object",
              "required": ["x", "y"],
              "properties": {
                "x": { "type": "number", "minimum": 0, "maximum": 1 },
                "y": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            },
            "hitRegion": {
              "type": "object",
              "required": ["type"],
              "properties": {
                "type": { "type": "string", "enum": ["circle", "rect"] },
                "cx": { "type": "number" },
                "cy": { "type": "number" },
                "r": { "type": "number" },
                "x": { "type": "number" },
                "y": { "type": "number" },
                "w": { "type": "number" },
                "h": { "type": "number" }
              }
            }
          }
        },

        "behavior": {
          "type": "object",
          "required": ["states"],
          "properties": {
            "valueDomain": {
              "type": "object",
              "properties": {
                "min": { "type": "number" },
                "max": { "type": "number" }
              }
            },
            "rotation": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "pivot": {
                  "type": "object",
                  "properties": {
                    "x": { "type": "number" },
                    "y": { "type": "number" }
                  }
                },
                "startDegrees": { "type": "number" },
                "sweepDegrees": { "type": "number" },
                "appliesToLayerId": { "type": "string" }
              }
            },
            "states": {
              "type": "array",
              "items": { "type": "string" },
              "minItems": 1
            }
          }
        }
      }
    },

    "layers": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "role", "file", "z", "blend", "defaultOpacity"],
        "additionalProperties": true,
        "properties": {
          "id": { "type": "string" },
          "role": { "type": "string" },
          "file": { "type": "string", "pattern": "\\.(png|webp)$" },
          "z": { "type": "integer" },
          "blend": {
            "type": "string",
            "enum": ["normal", "multiply", "screen", "add"]
          },
          "defaultOpacity": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "stateOpacity": {
            "type": "object",
            "additionalProperties": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          },
          "transform": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["rotateByValue", "translateByValue"]
              },
              "pivot": {
                "type": "object",
                "properties": {
                  "x": { "type": "number" },
                  "y": { "type": "number" }
                }
              },
              "startDegrees": { "type": "number" },
              "sweepDegrees": { "type": "number" }
            }
          }
        }
      }
    },

    "stateLogic": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["visible"],
        "properties": {
          "visible": {
            "type": "array",
            "items": { "type": "string" }
          },
          "opacityOverrides": {
            "type": "object",
            "additionalProperties": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      }
    },

    "renderingNotes": {
      "type": "object",
      "additionalProperties": true
    }
  }
}
